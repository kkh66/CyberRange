{% extends 'base.html' %}
{% load static %}
{% block title %}Scenario Detail{% endblock %}
{% block styles %}
    <link href="{% static 'css/scenario.css' %}" rel="stylesheet">
    <style rel="stylesheet">
        .scenario_status_box {
    background: #fff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.scenario_progress_bar_container {
    background: #f0f0f0;
    border-radius: 20px;
    height: 30px;
    position: relative;
    overflow: hidden;
}

.scenario_progress_bar {
    background: linear-gradient(90deg, #4CAF50, #45a049);
    height: 100%;
    border-radius: 20px;
    transition: width 0.3s ease;
    position: relative;
}

.progress-text {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

.btn-group {
    width: 100%;
}

.btn-group .btn {
    flex: 1;
    padding: 8px 16px;
}

#containerStatus .badge {
    font-size: 0.9em;
    padding: 6px 12px;
}

#levelDisplay .badge {
    font-size: 0.9em;
    padding: 6px 12px;
    background-color: #2196F3;
}

#containerRuntime {
    font-family: monospace;
    font-size: 1.1em;
    color: #666;
}
    </style>
{% endblock %}
{% block content %}
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Back Button -->
                <div class="mb-4">
                    <a href="{% url 'scenario:scenario_list' group.id %}"
                       class="scenario_back_btn">
                        <i class="fas fa-chevron-left me-2"></i>Back to Scenarios
                    </a>
                </div>

                <!-- Scenario Header -->
                <div class="scenario_card">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center mb-3">
                            <div class="scenario_icon">
                                <i class="fas fa-laptop-code text-primary"></i>
                            </div>
                            <div>
                                <h2 class="h4 mb-1">{{ scenario.name }}</h2>
                                <p class="text-muted mb-0 small">{{ scenario.description }}</p>
                            </div>
                        </div>

                        {% if user_scenario %}
                            <!-- Container Status Box -->
                            <div class="scenario_status_box"
                                 data-scenario-id="{{ scenario.id }}"
                                 data-status-url="{% url 'scenario:container_status' scenario.id %}">
                                
                                <!-- Status and Level -->
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div class="d-flex align-items-center">
                                        <div id="containerStatus" class="me-3">Loading...</div>
                                        <div id="levelDisplay"></div>
                                    </div>
                                    <div id="containerRuntime">00:00:00</div>
                                </div>

                                <!-- Progress Bar -->
                                <div class="scenario_progress_bar_container mb-4">
                                    <div class="scenario_progress_bar" id="progressBar" role="progressbar"
                                         style="width: 0%">
                                        <span id="progressText" class="progress-text">0%</span>
                                    </div>
                                </div>

                                <!-- Control Buttons -->
                                <div class="d-flex gap-2 flex-wrap mb-4">
                                    <form method="post" action="{% url 'scenario:container_action' scenario.id %}">
                                        {% csrf_token %}
                                        <div class="btn-group" role="group">
                                            <button type="submit" name="action" value="pause" class="btn btn-outline-warning">
                                                <i class="fas fa-pause"></i>
                                            </button>
                                            <button type="submit" name="action" value="unpause" class="btn btn-outline-success">
                                                <i class="fas fa-play"></i>
                                            </button>
                                            <button type="submit" name="action" value="restart" class="btn btn-outline-primary">
                                                <i class="fas fa-sync"></i>
                                            </button>
                                            <button type="submit" name="action" value="stop" class="btn btn-outline-danger">
                                                <i class="fas fa-stop"></i>
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <!-- Access Button -->
                                <a href="http://127.0.0.1:{{ user_scenario.port }}"
                                   target="_blank"
                                   class="btn btn-primary w-100">
                                    <i class="fas fa-external-link-alt me-2"></i>Access Scenario
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block Script %}
    <script src="{% static 'js/scenario-detail.js' %}"></script>

    {% if user_scenario %}
        <script>
            window.addEventListener('load', function () {
                try {
                    const statusBox = document.querySelector('.scenario_status_box');
                    if (statusBox) {
                        const scenarioManager = new ScenarioManager(
                            statusBox.dataset.scenarioId,
                            statusBox.dataset.statusUrl
                        );
                        scenarioManager.init();
                    } else {
                        console.error('Status box not found');
                    }
                } catch (error) {
                    console.error('Error initializing ScenarioManager:', error);
                }
            });
        </script>
    {% endif %}
{% endblock %}
